/*
The MIT License (MIT)

Copyright (c) 2015-2016 Robert Rypu≈Ça - https://audio-network.rypula.pl

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

"use strict";var AudioNetwork={};AudioNetwork.Version="1.0.4",AudioNetwork.Injector=function(){var e;return e=function(){this.$$injectRepository={}},e.RESOLVE_RECURSION_LIMIT=20,e.RESOLVE_RECURSION_LIMIT_EXCEED_EXCEPTION="Injector - resolve recursion limit exceed",e.MULTIPLE_REGISTER_EXCEPTION="Injector - multiple register calls for the same name",e.UNABLE_TO_FIND_ITEM_EXCEPTION="Injector - unable to find factory/service for given name: ",e.TYPE={SERVICE:"SERVICE",FACTORY:"FACTORY"},e.$$resolveRecursionCounter=0,e.prototype.$$register=function(t,i,r){if("undefined"!=typeof this.$$injectRepository[t])throw e.MULTIPLE_REGISTER_EXCEPTION;this.$$injectRepository[t]={type:r,item:i,resolveCache:null}},e.prototype.registerService=function(t,i){this.$$register(t,i,e.TYPE.SERVICE)},e.prototype.registerFactory=function(t,i){this.$$register(t,i,e.TYPE.FACTORY)},e.prototype.resolve=function(t){var i,r,n=[];if(r=this.$$find(t),r.resolveCache)return r.resolveCache;for(this.$$resolveRecursionInc(),i=0;i<r.item.$inject.length;i++)n.push(this.resolve(r.item.$inject[i]));switch(r.type){case e.TYPE.SERVICE:r.resolveCache=this.$$injectDependenciesAndInstantiate(r,n);break;case e.TYPE.FACTORY:r.resolveCache=this.$$injectDependencies(r,n)}return this.$$resolveRecursionDec(),r.resolveCache},e.prototype.$$resolveRecursionInc=function(){if(e.$$resolveRecursionCounter++,e.$$resolveRecursionCounter>=e.RESOLVE_RECURSION_LIMIT)throw e.RESOLVE_RECURSION_LIMIT_EXCEED_EXCEPTION},e.prototype.$$resolveRecursionDec=function(){e.$$resolveRecursionCounter--},e.prototype.$$injectDependenciesAndInstantiate=function(e,t){var i,r=e,n=t;switch(t.length){case 0:i=new r.item;break;case 1:i=new r.item(n[0]);break;case 2:i=new r.item(n[0],n[1]);break;case 3:i=new r.item(n[0],n[1],n[2]);break;case 4:i=new r.item(n[0],n[1],n[2],n[3]);break;case 5:i=new r.item(n[0],n[1],n[2],n[3],n[4]);break;case 6:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5]);break;case 7:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case 8:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);break;case 9:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]);break;case 10:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9]);break;case 11:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10]);break;case 12:i=new r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11])}return i},e.prototype.$$injectDependencies=function(e,t){var i,r=e,n=t;switch(t.length){case 0:i=r.item();break;case 1:i=r.item(n[0]);break;case 2:i=r.item(n[0],n[1]);break;case 3:i=r.item(n[0],n[1],n[2]);break;case 4:i=r.item(n[0],n[1],n[2],n[3]);break;case 5:i=r.item(n[0],n[1],n[2],n[3],n[4]);break;case 6:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5]);break;case 7:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case 8:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);break;case 9:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]);break;case 10:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9]);break;case 11:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10]);break;case 12:i=r.item(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11])}return i},e.prototype.$$find=function(t){var i;for(i in this.$$injectRepository)if(this.$$injectRepository.hasOwnProperty(i)&&i===t)return this.$$injectRepository[i];throw e.UNABLE_TO_FIND_ITEM_EXCEPTION+t},new e}(),function(){function e(e,t,i){function r(e,r){var n,o,a,s,$;for(a=[],o=t.accessor(e,r+".channel"),s=!!o,o=o?o:[],$=o.length,n=0;(s?$:2)>n;n++)a.push({baseFrequency:t.accessor(o[n],"baseFrequency")||(n%2===0?i.CHANNEL_1_FREQUENCY:i.CHANNEL_2_FREQUENCY),ofdmSize:t.accessor(o[n],"ofdmSize")||i.OFDM_SIZE,ofdmFrequencySpacing:t.accessor(o[n],"ofdmFrequencySpacing")||i.OFDM_FREQUENCY_SPACING});return a}function n(n){var o,a=n,s=t.accessor;return o={tx:{bufferSize:a&&a.tx&&"undefined"!=typeof a.tx.bufferSize?a.tx.bufferSize:0,channel:r(a,"tx")},rx:{bufferSize:a&&a.rx&&"undefined"!=typeof a.rx.bufferSize?a.rx.bufferSize:0,channel:r(a,"rx"),input:s(a,"rx.input")||i.RX_INPUT,notificationPerSecond:s(a,"rx.notificationPerSecond")||i.RX_NOTIFICATION_PER_SECOND,dftWindowTime:s(a,"rx.dftWindowTime")||i.RX_DFT_WINDOW_TIME,spectrum:{elementId:s(a,"rx.spectrum.elementId")||null,color:{axis:s(a,"rx.spectrum.color.axis")||"#444",data:s(a,"rx.spectrum.color.data")||"#888888"},fftSize:s(a,"rx.spectrum.fftSize")||i.RX_SPECTRUM_FFT_SIZE,height:s(a,"rx.spectrum.height")||200},constellationDiagram:{elementId:s(a,"rx.constellationDiagram.elementId")||null,color:{historyPoint:{red:{newest:s(a,"rx.constellationDiagram.color.historyPoint.red.newest")||0,tailNewest:s(a,"rx.constellationDiagram.color.historyPoint.red.tailNewest")||100,tailOldest:s(a,"rx.constellationDiagram.color.historyPoint.red.tailOldest")||180},green:{newest:s(a,"rx.constellationDiagram.color.historyPoint.green.newest")||0,tailNewest:s(a,"rx.constellationDiagram.color.historyPoint.green.tailNewest")||100,tailOldest:s(a,"rx.constellationDiagram.color.historyPoint.green.tailOldest")||200},blue:{newest:s(a,"rx.constellationDiagram.color.historyPoint.blue.newest")||0,tailNewest:s(a,"rx.constellationDiagram.color.historyPoint.blue.tailNewest")||100,tailOldest:s(a,"rx.constellationDiagram.color.historyPoint.blue.tailOldest")||150}},axis:s(a,"rx.constellationDiagram.color.axis")||"green"},historyPointSize:e.round(s(a,"rx.constellationDiagram.historyPointSize")||i.RX_HISTORY_POINT_SIZE),width:s(a,"rx.constellationDiagram.width")||200,height:s(a,"rx.constellationDiagram.height")||200}}}}return{parse:n}}AudioNetwork.Injector.registerService("PhysicalLayer.ConfigurationParser",e),e.$inject=["Common.MathUtil","Common.Util","PhysicalLayer.DefaultConfig"]}(),function(){function e(e,t){var i=4,r=1/i,n=.26,o=.74,a=5,s=r*n,$=s,l=r*o,c=l*a,h=2,u=h/s,p=1/s,d=2.5,f=t.round(d*p),y=f;return{CONSTELLATION_DIAGRAM_DECIBEL_LIMIT:40,MINIMUM_POWER_DECIBEL:-99,FAKE_NOISE_MAX_AMPLITUDE:.001,CHANNEL_1_FREQUENCY:1070,CHANNEL_2_FREQUENCY:2025,OFDM_SIZE:1,OFDM_FREQUENCY_SPACING_POSITIVE_INTEGER:h,OFDM_FREQUENCY_SPACING:u,SYMBOL_FREQUENCY:p,SYMBOL_FREQUENCY_FACTOR:d,RX_INPUT:e.MICROPHONE,RX_NOTIFICATION_PER_SECOND:f,RX_HISTORY_POINT_SIZE:y,RX_DFT_WINDOW_TIME:$,RX_SPECTRUM_FFT_SIZE:1024,BAUD:i,BAUD_MULTIPLICATIVE_INVERSE:r,FACTOR_SYMBOL:n,FACTOR_GUARD:o,SYNC_DURATION:2,SYMBOL_DURATION:s,GUARD_INTERVAL:l,FACTOR_INTERPACKET_GAP:a,INTERPACKET_GAP:c,PSK_SIZE:2,SYNC_PREAMBLE:!0}}AudioNetwork.Injector.registerService("PhysicalLayer.DefaultConfig",e),e.$inject=["PhysicalLayer.RxInput","Common.MathUtil"]}(),function(){function e(e,t,i,r,n,o,a,s,$,l,c){var h;return h=function(e){this.$$configuration=i.parse(e),this.$$channelTransmitManager=null,this.$$channelReceiveManager=null,this.$$currentInput=null,this.$$rxAnalyser=null,this.$$rxAnalyserChart=null,this.$$rxConstellationDiagram=[],this.$$outputTx=void 0,this.$$outputMicrophone=void 0,this.$$outputRecordedAudio=void 0,this.$$rxExternalHandler={callback:null},this.$$rxHandler=n.build(this.$$rxConstellationDiagram,this.$$rxExternalHandler),this.$$initTx(),this.$$initRx(),this.setRxInput(this.$$configuration.rx.input)},h.prototype.$$initTx=function(){this.$$channelTransmitManager=o.build(this.$$configuration.tx.channel,this.$$configuration.tx.bufferSize),this.outputTxEnable(),this.outputMicrophoneDisable(),this.outputRecordedAudioDisable()},h.prototype.$$initConstellationDiagram=function(t,i){var r,n,o,a;for(n=[],o=[],r=0;r<i.ofdmSize;r++){if(a=this.$$configuration.rx.constellationDiagram.elementId,a=a.replace("{{ channelIndex }}",t+""),a=a.replace("{{ ofdmIndex }}",r+""),!document.getElementById(a))throw"Constellation diagram DOM element not found";n.push(e.build(2*this.$$configuration.rx.constellationDiagram.historyPointSize)),o.push(s.build(document.getElementById(a),n[n.length-1],this.$$configuration.rx.constellationDiagram.width,this.$$configuration.rx.constellationDiagram.height,this.$$configuration.rx.constellationDiagram.color.axis,this.$$configuration.rx.constellationDiagram.color.historyPoint))}this.$$rxConstellationDiagram.push({constellationDiagram:o,queue:n})},h.prototype.$$initRx=function(){var e,i,r=t.round(l.getSampleRate()*this.$$configuration.rx.dftWindowTime),n=t.round(l.getSampleRate()/this.$$configuration.rx.notificationPerSecond);for(i=0;i<this.$$configuration.rx.channel.length;i++)e=this.$$configuration.rx.channel[i],e.dftWindowSize=r,e.notifyInterval=n,e.notifyHandler=this.$$rxHandler.handle.bind(this.$$rxHandler),this.$$configuration.rx.constellationDiagram.elementId&&this.$$initConstellationDiagram(i,e);if(this.$$channelReceiveManager=a.build(this.$$configuration.rx.channel,this.$$configuration.rx.bufferSize),this.$$rxAnalyser=l.createAnalyser(),this.$$rxAnalyser.fftSize=this.$$configuration.rx.spectrum.fftSize,this.$$rxAnalyser.connect(this.$$channelReceiveManager.getInputNode()),this.$$configuration.rx.spectrum.elementId){if(!document.getElementById(this.$$configuration.rx.spectrum.elementId))throw"Spectrum DOM element not found";this.$$rxAnalyserChart=$.build(document.getElementById(this.$$configuration.rx.spectrum.elementId),this.$$rxAnalyser,this.$$configuration.rx.spectrum.height,this.$$configuration.rx.spectrum.color.data,this.$$configuration.rx.spectrum.color.axis)}},h.prototype.$$getTxInputNode=function(e){var t=null;switch(e){case r.MICROPHONE:t=l.getMicrophoneNode();break;case r.LOOPBACK:t=this.$$channelTransmitManager.getOutputNode();break;case r.RECORDED_AUDIO:t=l.getRecordedAudioNode()}return t},h.prototype.getRxInput=function(){return this.$$currentInput},h.prototype.setRxInput=function(e){var t;this.$$currentInput&&this.$$getTxInputNode(this.$$currentInput).disconnect(this.$$rxAnalyser),t=this.$$getTxInputNode(e),t?(t.connect(this.$$rxAnalyser),this.$$currentInput=e,this.$$currentInput===r.LOOPBACK?this.$$channelTransmitManager.enableFakeNoise():this.$$channelTransmitManager.disableFakeNoise()):this.$$currentInput=null},h.prototype.getTxBufferSize=function(){return this.$$channelTransmitManager.getBufferSize()},h.prototype.getRxBufferSize=function(){return this.$$channelReceiveManager.getBufferSize()},h.prototype.loadRecordedAudio=function(e){return l.loadRecordedAudio(e)},h.prototype.tx=function(e,i){var r,n,o=this.$$channelTransmitManager.getChannel(e),a=[];if(!i)throw"Please specify data to send";for(n=0;n<i.length;n++){if(r=i[n],!r.duration)throw"Tx - duration of all data items should be > 0";a.push({amplitude:"undefined"!=typeof r.amplitude?r.amplitude:1,duration:t.round(l.getSampleRate()*r.duration),phase:"undefined"!=typeof r.phase?r.phase:0})}o.addToQueue(a)},h.prototype.rx=function(e){this.$$rxExternalHandler.callback="function"==typeof e?e:null},h.prototype.getSampleRate=function(){return l.getSampleRate()},h.prototype.destroy=function(){var e,t,i=[];if(this.setRxInput(null),this.$$rxAnalyserChart&&(i.push(this.$$rxAnalyserChart.destroy()),this.$$rxAnalyserChart=null),this.$$rxAnalyser.disconnect(this.$$channelReceiveManager.getInputNode()),this.$$rxConstellationDiagram)for(e=0;e<this.$$rxConstellationDiagram.length;e++)for(t=0;t<this.$$rxConstellationDiagram[e].constellationDiagram.length;t++)i.push(this.$$rxConstellationDiagram[e].constellationDiagram[t].destroy());return this.$$channelReceiveManager.destroy(),this.$$channelReceiveManager=null,this.outputTxDisable(),this.outputRecordedAudioDisable(),this.outputMicrophoneDisable(),this.$$channelTransmitManager.destroy(),this.$$channelTransmitManager=null,this.$$rxHandler.destroy(),c.buildFromList(i)},h.prototype.getOutputTxState=function(){return this.$$outputTx},h.prototype.getOutputMicrophoneState=function(){return this.$$outputMicrophone},h.prototype.getOutputRecordedAudioState=function(){return this.$$outputRecordedAudio},h.prototype.outputTxEnable=function(){this.$$outputTx||this.$$channelTransmitManager.getOutputNode().connect(l.getDestination()),this.$$outputTx=!0},h.prototype.outputTxDisable=function(){this.$$outputTx&&this.$$channelTransmitManager.getOutputNode().disconnect(l.getDestination()),this.$$outputTx=!1},h.prototype.outputMicrophoneEnable=function(){this.$$outputMicrophone||l.getMicrophoneNode().connect(l.getDestination()),this.$$outputMicrophone=!0},h.prototype.outputMicrophoneDisable=function(){this.$$outputMicrophone&&l.getMicrophoneNode().disconnect(l.getDestination()),this.$$outputMicrophone=!1},h.prototype.outputRecordedAudioEnable=function(){this.$$outputRecordedAudio||l.getRecordedAudioNode().connect(l.getDestination()),this.$$outputRecordedAudio=!0},h.prototype.outputRecordedAudioDisable=function(){this.$$outputRecordedAudio&&l.getRecordedAudioNode().disconnect(l.getDestination()),this.$$outputRecordedAudio=!1},h.prototype.getRxCpuLoadData=function(){return this.$$channelReceiveManager.getCpuLoadData()},h.prototype.getTxCpuLoadData=function(){return this.$$channelTransmitManager.getCpuLoadData()},h.prototype.getRxFrequency=function(e,t){return this.$$channelReceiveManager.getChannel(e).getFrequency(t)},h.prototype.getTxFrequency=function(e,t){return this.$$channelTransmitManager.getChannel(e).getFrequency(t)},h.prototype.setRxFrequency=function(e,t,i){this.$$channelReceiveManager.getChannel(e).setFrequency(t,i)},h.prototype.setTxFrequency=function(e,t,i){this.$$channelTransmitManager.getChannel(e).setFrequency(t,i)},h.prototype.getRxPhaseCorrection=function(e,t){return this.$$channelReceiveManager.getChannel(e).getRxPhaseCorrection(t)},h.prototype.getTxPhaseCorrection=function(e,t){return this.$$channelTransmitManager.getChannel(e).getTxPhaseCorrection(t)},h.prototype.setRxPhaseCorrection=function(e,t,i){this.$$channelReceiveManager.getChannel(e).setRxPhaseCorrection(t,i)},h.prototype.setTxPhaseCorrection=function(e,t,i){this.$$channelTransmitManager.getChannel(e).setTxPhaseCorrection(t,i)},h.prototype.getTxChannelSize=function(){return this.$$channelTransmitManager.getChannelSize()},h.prototype.getRxChannelSize=function(){return this.$$channelReceiveManager.getChannelSize()},h.prototype.getTxChannelOfdmSize=function(e){return this.$$channelTransmitManager.getChannel(e).getOfdmSize()},h.prototype.getRxChannelOfdmSize=function(e){return this.$$channelReceiveManager.getChannel(e).getOfdmSize()},h}AudioNetwork.Injector.registerFactory("PhysicalLayer.PhysicalLayer",e),e.$inject=["Common.QueueBuilder","Common.MathUtil","PhysicalLayer.ConfigurationParser","PhysicalLayer.RxInput","PhysicalLayer.RxHandlerBuilder","PhysicalLayer.ChannelTransmitManagerBuilder","PhysicalLayer.ChannelReceiveManagerBuilder","Visualizer.ConstellationDiagramBuilder","Visualizer.AnalyserChartBuilder","Audio.ActiveAudioContext","Common.SimplePromiseBuilder"]}(),function(){function e(){return{MICROPHONE:"MICROPHONE",LOOPBACK:"LOOPBACK",RECORDED_AUDIO:"RECORDED_AUDIO"}}AudioNetwork.Injector.registerService("PhysicalLayer.RxInput",e),e.$inject=[]}(),function(){function e(){return{NO_INPUT:"NO_INPUT",IDLE_INIT:"IDLE_INIT",FIRST_SYNC_WAIT:"FIRST_SYNC_WAIT",FIRST_SYNC:"FIRST_SYNC",FATAL_ERROR:"FATAL_ERROR",IDLE:"IDLE",SYMBOL:"SYMBOL",SYNC:"SYNC",GUARD:"GUARD",ERROR:"ERROR"}}AudioNetwork.Injector.registerService("PhysicalLayerAdapter.ReceiveAdapterState",e),e.$inject=[]}(),function(){function e(e,t,i){var r;return r=function(i){var n,o,a;for(this.$$physicalLayer=i,this.$$stateMachineManager=[],this.$$packetReceiveHandler=null,this.$$frequencyUpdateHandler=null,this.$$phaseCorrectionUpdateHandler=null,o=this.$$physicalLayer.getRxChannelSize(),n=0;o>n;n++)a=t.build(n,this.$$packetReceiveInternalHandler.bind(this),this.$$frequencyUpdateInternalHandler.bind(this),this.$$phaseCorrectionUpdateInternalHandler.bind(this)),this.$$stateMachineManager.push(a);this.setSymbolDuration(e.SYMBOL_DURATION),this.setGuardInterval(e.GUARD_INTERVAL),this.setSyncDuration(e.SYNC_DURATION),this.setSampleCollectionTimeIdleInitState(r.$$_SAMPLE_COLLECTION_TIME_IDLE_INIT_STATE),this.setSampleCollectionTimeFirstSyncState(r.$$_SAMPLE_COLLECTION_TIME_FIRST_SYNC_STATE),this.setSyncPreamble(e.SYNC_PREAMBLE),this.setPskSize(r.$$_ALL_CHANNEL,e.PSK_SIZE)},r.$$_SAMPLE_COLLECTION_TIME_IDLE_INIT_STATE=e.SYNC_DURATION,r.$$_SAMPLE_COLLECTION_TIME_FIRST_SYNC_STATE=.85*e.SYNC_DURATION,r.$$_TIME_TOLERANCE_SYMBOL_DURATION_FACTOR=2.2,r.$$_TIME_TOLERANCE_GUARD_INTERVAL_FACTOR=1.1,r.$$_TIME_TOLERANCE_SYNC_DURATION_FACTOR=1.1,r.$$_ALL_CHANNEL=null,r.prototype.reset=function(e){return this.$$checkChannelIndexRange(e),this.$$stateMachineManager[e].reset()},r.prototype.setSymbolDuration=function(e){var t,i;for(t=this.$$physicalLayer.getRxChannelSize(),i=0;t>i;i++)this.$$stateMachineManager[i].setSymbolStateMaxDurationTime(e*r.$$_TIME_TOLERANCE_SYMBOL_DURATION_FACTOR)},r.prototype.setGuardInterval=function(e){var t,i;for(t=this.$$physicalLayer.getRxChannelSize(),i=0;t>i;i++)this.$$stateMachineManager[i].setGuardStateMaxDurationTime(e*r.$$_TIME_TOLERANCE_GUARD_INTERVAL_FACTOR)},r.prototype.setSyncDuration=function(e){var t,i;for(t=this.$$physicalLayer.getRxChannelSize(),i=0;t>i;i++)this.$$stateMachineManager[i].setSyncStateMaxDurationTime(e*r.$$_TIME_TOLERANCE_SYNC_DURATION_FACTOR)},r.prototype.setSampleCollectionTimeIdleInitState=function(e){var t,i;for(t=this.$$physicalLayer.getRxChannelSize(),i=0;t>i;i++)this.$$stateMachineManager[i].setSampleCollectionTimeIdleInitState(e)},r.prototype.setSampleCollectionTimeFirstSyncState=function(e){var t,i;for(t=this.$$physicalLayer.getRxChannelSize(),i=0;t>i;i++)this.$$stateMachineManager[i].setSampleCollectionTimeFirstSyncState(e)},r.prototype.setSyncPreamble=function(e){var t,i;for(e=!!e,t=this.$$physicalLayer.getRxChannelSize(),i=0;t>i;i++)this.$$stateMachineManager[i].setSyncPreamble(e)},r.prototype.setPskSize=function(e,t){var i,n;if(e===r.$$_ALL_CHANNEL)for(i=this.$$physicalLayer.getRxChannelSize(),n=0;i>n;n++)this.$$stateMachineManager[n].setPskSize(t);else this.$$checkChannelIndexRange(e),this.$$stateMachineManager[e].setPskSize(t)},r.prototype.$$packetReceiveInternalHandler=function(e,t){var i;for(i=0;i<t.length;i++)1===t[i].length&&(t[i]=t[i][0]);this.$$packetReceiveHandler&&this.$$packetReceiveHandler(e,t)},r.prototype.$$frequencyUpdateInternalHandler=function(e,t){var r;null!==t&&(i.abs(t)>.005&&(r=this.$$physicalLayer.getRxFrequency(e,0),console.log("phase history current",r),this.$$physicalLayer.setRxFrequency(e,0,r+t),console.log("Frequency corrected for channel "+e+" at ofdm 0: "+(r+t))),this.$$frequencyUpdateHandler&&this.$$frequencyUpdateHandler(e,t))},r.prototype.$$phaseCorrectionUpdateInternalHandler=function(e,t){var i,r;for(r=0;r<t.length;r++)i=this.$$physicalLayer.getRxPhaseCorrection(e,r),this.$$physicalLayer.setRxPhaseCorrection(e,r,i+t[r].phase),console.log("Phase corrected for channel "+e+" at ofdm "+r+": "+(i+t[r].phase));this.$$phaseCorrectionUpdateHandler&&this.$$phaseCorrectionUpdateHandler(e,t)},r.prototype.$$checkChannelIndexRange=function(e){if(0>e||e>=this.$$physicalLayer.getRxChannelSize())throw"Given channelIndex is outside range: "+e},r.prototype.setPacketReceiveHandler=function(e){"function"==typeof e?this.$$packetReceiveHandler=e:this.$$packetReceiveHandler=null},r.prototype.setFrequencyUpdateHandler=function(e){"function"==typeof e?this.$$frequencyUpdateHandler=e:this.$$frequencyUpdateHandler=null},r.prototype.setPhaseCorrectionUpdateHandler=function(e){"function"==typeof e?this.$$phaseCorrectionUpdateHandler=e:this.$$phaseCorrectionUpdateHandler=null},r.prototype.receive=function(e,t,i){return this.$$checkChannelIndexRange(e),this.$$stateMachineManager[e].receive(t,i)},r}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.ReceiveAdapter",e),e.$inject=["PhysicalLayer.DefaultConfig","PhysicalLayerAdapter.RxStateMachineManagerBuilder","Common.MathUtil"]}(),function(){function e(e,t,i){var r;return r=function(e){this.$$physicalLayer=e},r.AMPLITUDE_DATA_LENGTH_DOES_NOT_MATCH_SYMBOL_LIST_LENGTH_EXCEPTION="Amplitude data length does not match symbol list length",r.$$_SYNCHRONIZATION_SYMBOL=0,r.$$_LOWEST_PSK_SIZE=1,r.$$_ZERO_GUARD_INTERVAL=0,r.$$_ZERO_INTERPACKET_GAP=0,r.$$_NO_SYNC_PREAMBLE=!1,r.$$_UNDEFINED_AMPLITUDE=void 0,r.prototype.symbol=function(e,n,o,a,s){var $,l=this.$$physicalLayer.getTxChannelOfdmSize(e),c=[];for($=0;l>$;$++)c.push($===n?o:null);c=[1===c.length?c[0]:c],this.packet(e,c,r.$$_NO_SYNC_PREAMBLE,a,t.valueOrDefault(s,i.SYMBOL_DURATION),r.$$_ZERO_GUARD_INTERVAL,r.$$_ZERO_INTERPACKET_GAP,r.$$_UNDEFINED_AMPLITUDE)},r.prototype.packet=function(n,o,a,s,$,l,c,h){var u,p,d=this.$$physicalLayer.getTxChannelOfdmSize(n);if(a=t.valueOrDefault(a,i.SYNC_PREAMBLE)){for(u=[],p=0;d>p;p++)u.push(r.$$_SYNCHRONIZATION_SYMBOL);u=1===u.length?u[0]:u,o.unshift(u)}if("undefined"==typeof h)for(h=[],p=0;d>p;p++)h.push(e.floor(1e3/d)/1e3);this.$$transmit(n,o,t.valueOrDefault(s,i.PSK_SIZE),t.valueOrDefault($,i.SYMBOL_DURATION),t.valueOrDefault(l,i.GUARD_INTERVAL),t.valueOrDefault(c,i.INTERPACKET_GAP),h)},r.prototype.synchronization=function(t){var n,o=this.$$physicalLayer.getTxChannelOfdmSize(t),a=[],s=[];for(n=0;o>n;n++)a.push(r.$$_SYNCHRONIZATION_SYMBOL),s.push(e.floor(1e3/o)/1e3);a=[1===a.length?a[0]:a],this.$$transmit(t,a,r.$$_LOWEST_PSK_SIZE,i.SYNC_DURATION,r.$$_ZERO_GUARD_INTERVAL,i.INTERPACKET_GAP,s)},r.prototype.$$transmit=function(e,t,i,n,o,a,s){var $,l,c,h,u,p,d,f=this.$$physicalLayer.getTxChannelOfdmSize(e);for(c=[],p=0;p<t.length;p++){if($=1===f&&"number"==typeof t[p]?[t[p]]:t[p],$.length!==s.length)throw r.AMPLITUDE_DATA_LENGTH_DOES_NOT_MATCH_SYMBOL_LIST_LENGTH_EXCEPTION;for(h=[],d=0;d<$.length;d++)u=null===$[d],l=u?0:parseInt($[d])%i,h.push({amplitude:u?0:s[d],duration:n,phase:l/i});if(c.push(h),o>0){for(h=[],d=0;d<$.length;d++)h.push({amplitude:0,duration:o});c.push(h)}}if(a>0&&$){for(h=[],d=0;d<$.length;d++)h.push({amplitude:0,duration:a});c.push(h)}for(p=0;p<c.length;p++)this.$$physicalLayer.tx(e,c[p])},r}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.TransmitAdapter",e),e.$inject=["Common.MathUtil","Common.Util","PhysicalLayer.DefaultConfig"]}(),function(){function e(e){function t(){i=e.build()}var i=null;return t(),{loadRecordedAudio:i.loadRecordedAudio.bind(i),getMicrophoneNode:i.getMicrophoneNode.bind(i),getRecordedAudioNode:i.getRecordedAudioNode.bind(i),getSampleRate:i.getSampleRate.bind(i),getDestination:i.getDestination.bind(i),getCurrentTime:i.getCurrentTime.bind(i),createAnalyser:i.createAnalyser.bind(i),createGain:i.createGain.bind(i),createScriptProcessor:i.createScriptProcessor.bind(i)}}AudioNetwork.Injector.registerService("Audio.ActiveAudioContext",e),e.$inject=["Audio.SimpleAudioContextBuilder"]}(),function(){function e(e){function t(){return new e}return{build:t}}AudioNetwork.Injector.registerService("Audio.SimpleAudioContextBuilder",e),e.$inject=["Audio.SimpleAudioContext"]}(),function(){function e(e){var t;return t=function(){this.$$context=null,this.$$rawMicrophoneNode=null,this.$$microphoneNode=null,this.$$recordedNode=null,this.$$recordedRawNode=null,this.$$init()},t.prototype.getCurrentTime=function(){return this.$$context.currentTime},t.prototype.createAnalyser=function(){return this.$$context.createAnalyser()},t.prototype.createGain=function(){return this.$$context.createGain()},t.prototype.createScriptProcessor=function(e,t,i){return this.$$context.createScriptProcessor(e,t,i)},t.prototype.getSampleRate=function(){return this.$$context.sampleRate},t.prototype.getDestination=function(){return this.$$context.destination},t.prototype.getMicrophoneNode=function(){return this.$$microphoneNode},t.prototype.getRecordedAudioNode=function(){return this.$$recordedNode},t.prototype.loadRecordedAudio=function(t){var i=this,r=new XMLHttpRequest,n=e.build();return r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){i.$$context.decodeAudioData(r.response,function(e){i.$$recordedRawNode&&i.$$recordedRawNode.disconnect(i.$$recordedNode),i.$$recordedRawNode=i.$$context.createBufferSource(),i.$$recordedRawNode.buffer=e,i.$$recordedRawNode.connect(i.$$recordedNode),i.$$recordedRawNode.loop=!0,i.$$recordedRawNode.start(0),n.resolve()},function(e){n.reject(e)})},r.send(),n},t.prototype.$$getConstraints=function(){return{video:!1,audio:{mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1},optional:[]}}},t.prototype.$$normalizeGlobalVariable=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},t.prototype.$$init=function(){var e=this;this.$$normalizeGlobalVariable();try{this.$$context=new window.AudioContext}catch(t){alert("Web Audio API is not supported in this browser"),console.log(t)}this.$$microphoneNode=this.$$context.createGain(),this.$$recordedNode=this.$$context.createGain();try{navigator.getUserMedia(this.$$getConstraints(),function(t){e.$$rawMicrophoneNode=e.$$context.createMediaStreamSource(t),e.$$rawMicrophoneNode.connect(e.$$microphoneNode)},function(e){alert("Microphone initialization failed"),console.log(e)})}catch(t){alert("Microphone initialization failed"),console.log(t)}},t}AudioNetwork.Injector.registerFactory("Audio.SimpleAudioContext",e),e.$inject=["Common.SimplePromiseBuilder"]}(),function(){function e(){var e;return e=function(){this.$$valueList=[],this.$$lastFinalizedSize=void 0,this.$$lastFinalizedResult=void 0},e.ABSTRACT_METHOD_CALLED_EXCEPTION="Abstract method called!",e.prototype.collect=function(e){this.$$valueList.push(e)},e.prototype.hasAtLeastItem=function(){return this.getSize()>0},e.prototype.getSize=function(){return this.$$valueList.length},e.prototype.clearAll=function(){this.clearList(),this.$$lastFinalizedSize=void 0,this.$$lastFinalizedResult=void 0},e.prototype.clearList=function(){this.$$valueList.length=0},e.prototype.finalize=function(){return this.$$lastFinalizedResult=this.$$finalize(),this.$$lastFinalizedSize=this.getSize(),this.clearList(),this.$$lastFinalizedResult},e.prototype.getLastFinalizedSize=function(){return this.$$lastFinalizedSize},e.prototype.getLastFinalizedResult=function(){return this.$$lastFinalizedResult},e.prototype.$$finalize=function(){throw e.ABSTRACT_METHOD_CALLED_EXCEPTION},e}AudioNetwork.Injector.registerFactory("Common.AbstractValueCollector",e),e.$inject=[]}(),function(){function e(e){function t(){return new e}return{build:t}}AudioNetwork.Injector.registerService("Common.AverageValueCollectorBuilder",e),e.$inject=["Common.AverageValueCollector"]}(),function(){function e(e,t){var i;return i=function(){e.apply(this,arguments)},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.EMPTY_LIST_EXCEPTION="Cannot finalize AverageValueCollector without any samples collected",i.prototype.$$finalize=function(){if(0===this.$$valueList.length)throw i.EMPTY_LIST_EXCEPTION;return t.computeAverage(this.$$valueList)},i}AudioNetwork.Injector.registerFactory("Common.AverageValueCollector",e),e.$inject=["Common.AbstractValueCollector","Common.Util"]}(),function(){function e(e){function t(t){return new e(t)}return{build:t}}AudioNetwork.Injector.registerService("Common.CarrierGenerateBuilder",e),e.$inject=["Common.CarrierGenerate"]}(),function(){function e(e,t){var i;return i=function(e,t){this.$$samplePerFade=t,this.$$queue=[],this.$$sampleComputed=null,this.$$currentCarrier={data:null,sampleNumberStart:null,sampleNumberEnd:null},this.$$samplePerPeriod=null,this.$$omega=null,this.$$sampleNumber=0,this.$$phaseCorrection=0,this.setSamplePerPeriod(e)},i.prototype.$$sampleCompute=function(){var i,r,n,o=this.$$currentCarrier.data;return o?(i=1,this.$$samplePerFade>0&&(r=(this.$$sampleNumber-this.$$currentCarrier.sampleNumberStart)/this.$$samplePerFade,n=(this.$$currentCarrier.sampleNumberEnd-this.$$sampleNumber)/this.$$samplePerFade,r>=0&&1>=r?i=t.unitFade(r):n>=0&&1>=n&&(i=t.unitFade(n))),void(this.$$sampleComputed=i*o.amplitude*e.sin(this.$$omega*this.$$sampleNumber-e.TWO_PI*(o.phase-this.$$phaseCorrection)))):void(this.$$sampleComputed=0)},i.prototype.$$grabCurrentCarrier=function(){var e,i;e=t.queuePop(this.$$queue),e?(i=e===this.$$currentCarrier.data,i||(this.$$currentCarrier.data=e,this.$$currentCarrier.sampleNumberStart=this.$$sampleNumber,this.$$currentCarrier.sampleNumberEnd=this.$$currentCarrier.sampleNumberStart+e.duration)):(this.$$currentCarrier.data=null,this.$$currentCarrier.sampleNumberStart=null,this.$$currentCarrier.sampleNumberEnd=null)},i.prototype.setPhaseCorrection=function(e){this.$$phaseCorrection=e},i.prototype.nextSample=function(){this.$$sampleNumber++,this.$$sampleComputed=null},i.prototype.getSample=function(){return this.$$sampleComputed?this.$$sampleComputed:(this.$$grabCurrentCarrier(),this.$$sampleCompute(),this.$$sampleComputed)},i.prototype.addToQueue=function(e){t.queueAdd(this.$$queue,e,function(e,t){e.amplitude=t.amplitude,e.phase=t.phase})},i.prototype.setSamplePerPeriod=function(t){this.$$samplePerPeriod=t,this.$$omega=e.TWO_PI/this.$$samplePerPeriod,this.$$sampleNumber=0},i}AudioNetwork.Injector.registerFactory("Common.CarrierGenerate",e),e.$inject=["Common.MathUtil","Common.Util"]}(),function(){function e(e){function t(t,i){return new e(t,i)}return{build:t}}AudioNetwork.Injector.registerService("Common.CarrierRecoveryBuilder",e),e.$inject=["Common.CarrierRecovery"]}(),function(){function e(e,t,i){var r;return r=function(t,i){this.$$queue=e.build(2*i),this.$$queueSumReal=0,this.$$queueSumImm=0,this.$$referenceReal=0,this.$$referenceImm=0,this.$$real=0,this.$$imm=0,this.$$power=0,this.$$powerDecibel=0,this.$$phase=0,this.$$samplePerPeriod=null,this.$$omega=null,this.$$sampleNumber=0,this.setSamplePerPeriod(t)},r.prototype.$$computeReference=function(){var e=this.$$omega*this.$$sampleNumber;this.$$referenceReal=t.cos(e),this.$$referenceImm=t.sin(e)},r.prototype.$$computeAverage=function(e){var t,i,r;this.$$queue.isFull()&&(this.$$queueSumReal-=this.$$queue.pop(),this.$$queueSumImm-=this.$$queue.pop()),t=this.$$referenceReal*e,i=this.$$referenceImm*e,this.$$queue.push(t),this.$$queue.push(i),this.$$queueSumReal+=t,this.$$queueSumImm+=i,r=this.$$queue.getSize()>>>1,this.$$real=this.$$queueSumReal/r,this.$$imm=this.$$queueSumImm/r},r.prototype.$$computePower=function(){this.$$power=t.sqrt(this.$$real*this.$$real+this.$$imm*this.$$imm),this.$$powerDecibel=10*t.log(this.$$power)/t.LN10},r.prototype.$$computePhase=function(){this.$$phase=i.findUnitAngle(this.$$real,this.$$imm),this.$$phase=this.$$phase-.25,this.$$phase<0&&(this.$$phase+=1)},r.prototype.handleSample=function(e){this.$$computeReference(),this.$$computeAverage(e),this.$$sampleNumber++},r.prototype.getCarrierDetail=function(){return this.$$computePower(),this.$$computePhase(),{phase:this.$$phase,power:this.$$power,powerDecibel:this.$$powerDecibel}},r.prototype.setSamplePerPeriod=function(e){this.$$samplePerPeriod=e,this.$$omega=t.TWO_PI/this.$$samplePerPeriod,this.$$sampleNumber=0},r}AudioNetwork.Injector.registerFactory("Common.CarrierRecovery",e),e.$inject=["Common.QueueBuilder","Common.MathUtil","Common.Util"]}(),function(){function e(){function e(e){return Math.abs(e)}function t(e){return Math.asin(e)}function i(e){return Math.sqrt(e)}function r(e){return Math.round(e)}function n(){return Math.random()}function o(e){return Math.floor(e)}function a(e){return Math.sin(e)}function s(e){return Math.cos(e)}function $(e){return Math.log(e)}function l(e){return Math.min.apply(null,e)}function c(e){return Math.max.apply(null,e)}return{LN10:Math.LN10,HALF_PI:.5*Math.PI,TWO_PI:2*Math.PI,PI:Math.PI,abs:e,floor:o,asin:t,sqrt:i,round:r,random:n,sin:a,cos:s,log:$,minInArray:l,maxInArray:c}}AudioNetwork.Injector.registerService("Common.MathUtil",e),e.$inject=[]}(),function(){function e(e){function t(t){return new e(t)}return{build:t}}AudioNetwork.Injector.registerService("Common.QueueBuilder",e),e.$inject=["Common.Queue"]}(),function(){function e(){var e;return e=function(e){this.$$sizeMax=e,this.$$data=[],this.$$positionStart=0,this.$$positionEnd=0,this.$$size=0,this.$$data.length=e},e.prototype.push=function(e){return this.$$size===this.$$sizeMax?!1:(this.$$data[this.$$positionEnd]=e,this.$$positionEnd=(this.$$positionEnd+1)%this.$$sizeMax,
this.$$size++,!0)},e.prototype.pushEvenIfFull=function(e){this.isFull()&&this.pop(),this.push(e)},e.prototype.pop=function(){var e;return 0===this.$$size?null:(e=this.$$data[this.$$positionStart],this.$$positionStart=(this.$$positionStart+1)%this.$$sizeMax,this.$$size--,e)},e.prototype.getItem=function(e){return e>=this.$$size?null:this.$$data[(this.$$positionStart+e)%this.$$sizeMax]},e.prototype.getSize=function(){return this.$$size},e.prototype.getSizeMax=function(){return this.$$sizeMax},e.prototype.isFull=function(){return this.$$size===this.$$sizeMax},e}AudioNetwork.Injector.registerFactory("Common.Queue",e),e.$inject=[]}(),function(){function e(e){function t(){return new e}function i(e){var i,r,n,o;for(r=t(),n=0,o=0,i=0;i<e.length;i++)e[i].then(function(){n++})["catch"](function(){o++})["finally"](function(){n+o===e.length&&(0===o?r.resolve():r.reject())});return r}return{build:t,buildFromList:i}}AudioNetwork.Injector.registerService("Common.SimplePromiseBuilder",e),e.$inject=["Common.SimplePromise"]}(),function(){function e(){var e;return e=function(){this.$$state=null,this.$$value=void 0,this.$$then=null,this.$$catch=null,this.$$finally=null},e.$$STATE_RESOLVE=0,e.$$STATE_REJECT=1,e.prototype.$$callbackInvoke=function(){switch(this.$$state){case e.$$STATE_RESOLVE:this.$$then&&(this.$$then(this.$$value),this.$$then=null),this.$$finally&&(this.$$finally(this.$$value),this.$$finally=null);break;case e.$$STATE_REJECT:this.$$catch&&(this.$$catch(this.$$value),this.$$catch=null),this.$$finally&&(this.$$finally(this.$$value),this.$$finally=null)}},e.prototype.resolve=function(t){null===this.$$state&&(this.$$state=e.$$STATE_RESOLVE,this.$$value=t,this.$$callbackInvoke())},e.prototype.reject=function(t){null===this.$$state&&(this.$$state=e.$$STATE_REJECT,this.$$value=t,this.$$callbackInvoke())},e.prototype.then=function(e){return"function"==typeof e&&(this.$$then=e),this.$$callbackInvoke(),this},e.prototype["catch"]=function(e){return"function"==typeof e&&(this.$$catch=e),this.$$callbackInvoke(),this},e.prototype["finally"]=function(e){return"function"==typeof e&&(this.$$finally=e),this.$$callbackInvoke(),this},e}AudioNetwork.Injector.registerFactory("Common.SimplePromise",e),e.$inject=[]}(),function(){function e(e){function t(e,t){return"undefined"!=typeof e?e:t}function i(e,t){var i,r=t.split("."),n=e;if(e){for(i=0;i<r.length&&(n=n[r[i]],n);i++);return n}}function r(e){var t,i;if(!e||0===e.length)return 0;for(i=0,t=0;t<e.length;t++)i+=e[t];return i/e.length}function n(t,i){var r,n,o;switch(r=e.sqrt(t*t+i*i),r=1e-6>r?1e-6:r,n=i>=0?t>=0?0:1:0>t?2:3){case 0:o=e.asin(i/r);break;case 1:o=e.asin(-t/r)+e.HALF_PI;break;case 2:o=e.asin(-i/r)+e.PI;break;case 3:o=e.asin(t/r)+1.5*e.PI}return o/e.TWO_PI}function o(t){return t=0>t?0:t,t=t>1?1:t,.5*(e.sin((t-.5)*e.PI)+1)}function a(e,t,i,r){var n;r=void 0===r?"duration":r,t[r]>0&&(n={},n[r]=t[r],i(n,t),e.push(n))}function s(e,t){var i;return t=void 0===t?"duration":t,0===e.length?null:(e[0][t]--,i=e[0],0===e[0][t]&&e.splice(0,1),i)}function $(e,t){var r,n,o=null,a=null;if(!e)return null;for(r=0;r<e.length;r++)n=i(e[r],t),(null===a||n>o)&&(o=n,a=r);return a}return{valueOrDefault:t,accessor:i,computeAverage:r,findUnitAngle:n,unitFade:o,queueAdd:a,queuePop:s,findMaxValueIndex:$}}AudioNetwork.Injector.registerService("Common.Util",e),e.$inject=["Common.MathUtil"]}(),function(){function e(e){var t;return t=function(){this.$$cpuLoadData={blockSampleSize:null,blockTime:null,blockRealTime:null,load:null}},t.prototype.getCpuLoadData=function(){var e=this.$$cpuLoadData;return{blockSampleSize:e.blockSampleSize,blockTime:e.blockTime,blockRealTime:e.blockRealTime,load:e.load}},t.prototype.$$computeCpuLoadData=function(t,i,r){var n,o,a=this.$$cpuLoadData;n=i-t,o=r/e.getSampleRate(),a.blockSampleSize=r,a.blockTime=o,a.blockRealTime=n,a.load=n/o},t}AudioNetwork.Injector.registerFactory("PhysicalLayer.AbstractChannelManager",e),e.$inject=["Audio.ActiveAudioContext"]}(),function(){function e(e){function t(t,i){return new e(t,i)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayer.ChannelReceiveBuilder",e),e.$inject=["PhysicalLayer.ChannelReceive"]}(),function(){function e(e,t,i){var r;return r=function(e,t){this.$$carrierRecovery=[],this.$$carrierFrequency=[],this.$$carrierPhaseCorrection=[],this.$$notifyInterval=null,this.$$notifyHandler=null,this.$$index=e,this.configure(t)},r.OFDM_INDEX_OUT_OF_RANGE_EXCEPTION="OFDM index out of range: ",r.prototype.configure=function(i){var r,n,o,a;for(r=0;r<i.ofdmSize;r++)a=i.baseFrequency+r*i.ofdmFrequencySpacing,o=e.getSampleRate()/a,n=t.build(o,i.dftWindowSize),this.$$carrierRecovery.push(n),this.$$carrierFrequency.push(a),this.$$carrierPhaseCorrection.push(0);this.$$notifyInterval=i.notifyInterval,this.$$notifyHandler=i.notifyHandler},r.prototype.$$checkOfdmIndex=function(e){if(0>e||e>=this.$$carrierRecovery.length)throw r.OFDM_INDEX_OUT_OF_RANGE_EXCEPTION+e},r.prototype.getOfdmSize=function(){return this.$$carrierRecovery.length},r.prototype.getRxPhaseCorrection=function(e){return this.$$checkOfdmIndex(e),this.$$carrierPhaseCorrection[e]},r.prototype.getFrequency=function(e){return this.$$checkOfdmIndex(e),this.$$carrierFrequency[e]},r.prototype.setRxPhaseCorrection=function(e,t){this.$$checkOfdmIndex(e),this.$$carrierPhaseCorrection[e]=t-i.floor(t)},r.prototype.setFrequency=function(t,i){var r;this.$$checkOfdmIndex(t),r=e.getSampleRate()/i,this.$$carrierRecovery[t].setSamplePerPeriod(r),this.$$carrierFrequency[t]=i},r.prototype.handleSample=function(t,r,n,o){var a,s,$,l,c,h;for(a=r%this.$$notifyInterval===0,a&&(c=[]),l=0;l<this.$$carrierRecovery.length;l++)s=this.$$carrierRecovery[l],s.handleSample(t),a&&($=s.getCarrierDetail(),$.phase=$.phase-this.$$carrierPhaseCorrection[l],$.phase=$.phase-i.floor($.phase),c.push($));a&&(h=o/e.getSampleRate(),this.$$notifyHandler(this.$$index,c,n+h))},r.prototype.destroy=function(){this.$$carrierRecovery.length=0,this.$$carrierFrequency.length=0,this.$$carrierPhaseCorrection.length=0},r}AudioNetwork.Injector.registerFactory("PhysicalLayer.ChannelReceive",e),e.$inject=["Audio.ActiveAudioContext","Common.CarrierRecoveryBuilder","Common.MathUtil"]}(),function(){function e(e){function t(t,i){return new e(t,i)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayer.ChannelReceiveManagerBuilder",e),e.$inject=["PhysicalLayer.ChannelReceiveManager"]}(),function(){function e(e,t,i){var r;return r=function(t,i){e.apply(this,arguments),this.$$channelReceive=[],this.$$scriptNode=null,this.$$analyserNode=null,this.$$configuration=t,this.$$bufferSize=i,this.$$sampleNumberGlobal=0,this.$$init()},r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.CHANNEL_INDEX_OUT_OF_RANGE_EXCEPTION="Channel index out of range: ",r.$$_LOWEST_FFT_SIZE=256,r.prototype.destroy=function(){var e,t;for(e=0;e<this.$$channelReceive.length;e++)t=this.$$channelReceive[e],t.destroy();this.$$channelReceive.length=0},r.prototype.getInputNode=function(){return this.$$scriptNode},r.prototype.getChannelSize=function(){return this.$$channelReceive.length},r.prototype.getChannel=function(e){if(0>e||e>=this.$$channelReceive.length)throw r.CHANNEL_INDEX_OUT_OF_RANGE_EXCEPTION+e;return this.$$channelReceive[e]},r.prototype.getBufferSize=function(){return this.$$scriptNode.bufferSize},r.prototype.$$init=function(){var e,n;for(this.$$scriptNode=t.createScriptProcessor(this.$$bufferSize,1,1),this.$$scriptNode.onaudioprocess=this.onAudioProcess.bind(this),this.$$analyserNode=t.createAnalyser(),this.$$analyserNode.fftSize=r.$$_LOWEST_FFT_SIZE,this.$$scriptNode.connect(this.$$analyserNode),e=0;e<this.$$configuration.length;e++)n=i.build(e,this.$$configuration[e]),this.$$channelReceive.push(n)},r.prototype.onAudioProcess=function(e){var i,r,n,o=e.inputBuffer,a=o.getChannelData(0),s=t.getCurrentTime();for(r=0;r<o.length;r++){for(i=a[r],n=0;n<this.$$channelReceive.length;n++)this.$$channelReceive[n].handleSample(i,this.$$sampleNumberGlobal,s,r);this.$$sampleNumberGlobal++}this.$$computeCpuLoadData(s,t.getCurrentTime(),o.length)},r}AudioNetwork.Injector.registerFactory("PhysicalLayer.ChannelReceiveManager",e),e.$inject=["PhysicalLayer.AbstractChannelManager","Audio.ActiveAudioContext","PhysicalLayer.ChannelReceiveBuilder"]}(),function(){function e(e){function t(t,i){return new e(t,i)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayer.ChannelTransmitBuilder",e),e.$inject=["PhysicalLayer.ChannelTransmit"]}(),function(){function e(e,t,i){var r;return r=function(e,t){this.$$carrierGenerate=[],this.$$carrierFrequency=[],this.$$carrierPhaseCorrection=[],this.$$index=e,this.configure(t)},r.DATA_LENGTH_DOES_NOT_MATCH_OFDM_SIZE_EXCEPTION="Data array length does not match configured OFDM size",r.OFDM_INDEX_OUT_OF_RANGE_EXCEPTION="OFDM index out of range: ",r.prototype.addToQueue=function(e){var t;if(e.length!==this.$$carrierGenerate.length)throw r.DATA_LENGTH_DOES_NOT_MATCH_OFDM_SIZE_EXCEPTION;for(t=0;t<this.$$carrierGenerate.length;t++)this.$$carrierGenerate[t].addToQueue(e[t])},r.prototype.getOfdmSize=function(){return this.$$carrierGenerate.length},r.prototype.$$checkOfdmIndex=function(e){if(0>e||e>=this.$$carrierGenerate.length)throw r.OFDM_INDEX_OUT_OF_RANGE_EXCEPTION+e},r.prototype.getTxPhaseCorrection=function(e){return this.$$checkOfdmIndex(e),this.$$carrierPhaseCorrection[e]},r.prototype.getFrequency=function(e){return this.$$checkOfdmIndex(e),this.$$carrierFrequency[e]},r.prototype.setTxPhaseCorrection=function(t,i){this.$$checkOfdmIndex(t),this.$$carrierPhaseCorrection[t]=i-e.floor(i),this.$$carrierGenerate[t].setPhaseCorrection(this.$$carrierPhaseCorrection[t])},r.prototype.setFrequency=function(e,i){var r;this.$$checkOfdmIndex(e),r=t.getSampleRate()/i,this.$$carrierGenerate[e].setSamplePerPeriod(r),this.$$carrierFrequency[e]=i},r.prototype.configure=function(e){var r,n,o,a;for(r=0;r<e.ofdmSize;r++)a=e.baseFrequency+r*e.ofdmFrequencySpacing,o=t.getSampleRate()/a,n=i.build(o),this.$$carrierGenerate.push(n),this.$$carrierFrequency.push(a),this.$$carrierPhaseCorrection.push(0)},r.prototype.getSample=function(){var e,t,i;for(e=0,i=0;i<this.$$carrierGenerate.length;i++)t=this.$$carrierGenerate[i],e+=t.getSample(),t.nextSample();return e},r.prototype.destroy=function(){this.$$carrierGenerate.length=0,this.$$carrierFrequency.length=0,this.$$carrierPhaseCorrection.length=0},r}AudioNetwork.Injector.registerFactory("PhysicalLayer.ChannelTransmit",e),e.$inject=["Common.MathUtil","Audio.ActiveAudioContext","Common.CarrierGenerateBuilder"]}(),function(){function e(e){function t(t,i){return new e(t,i)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayer.ChannelTransmitManagerBuilder",e),e.$inject=["PhysicalLayer.ChannelTransmitManager"]}(),function(){function e(e,t,i,r,n){var o;return o=function(t,i){e.apply(this,arguments),this.$$channelTransmit=[],this.$$scriptNode=null,this.$$configuration=t,this.$$bufferSize=i,this.$$fakeNoise=!1,this.$$init()},o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.CHANNEL_INDEX_OUT_OF_RANGE_EXCEPTION="Channel index out of range: ",o.prototype.destroy=function(){var e,t;for(e=0;e<this.$$channelTransmit.length;e++)t=this.$$channelTransmit[e],t.destroy();this.$$channelTransmit.length=0},o.prototype.getOutputNode=function(){return this.$$scriptNode},o.prototype.getChannelSize=function(){return this.$$channelTransmit.length},o.prototype.getChannel=function(e){if(0>e||e>=this.$$channelTransmit.length)throw o.CHANNEL_INDEX_OUT_OF_RANGE_EXCEPTION+e;return this.$$channelTransmit[e]},o.prototype.getBufferSize=function(){return this.$$scriptNode.bufferSize},o.prototype.$$init=function(){var e,t;for(this.$$scriptNode=i.createScriptProcessor(this.$$bufferSize,1,1),this.$$scriptNode.onaudioprocess=this.onAudioProcess.bind(this),e=0;e<this.$$configuration.length;e++)t=n.build(e,this.$$configuration[e]),this.$$channelTransmit.push(t)},o.prototype.enableFakeNoise=function(){this.$$fakeNoise=!0},o.prototype.disableFakeNoise=function(){this.$$fakeNoise=!1},o.prototype.onAudioProcess=function(e){var n,o,a,s=e.outputBuffer,$=s.getChannelData(0),l=i.getCurrentTime();for(o=0;o<s.length;o++){for(n=0,a=0;a<this.$$channelTransmit.length;a++)n+=this.$$channelTransmit[a].getSample();this.$$fakeNoise&&(n+=(2*t.random()-1)*r.FAKE_NOISE_MAX_AMPLITUDE),$[o]=n}this.$$computeCpuLoadData(l,i.getCurrentTime(),s.length)},o}AudioNetwork.Injector.registerFactory("PhysicalLayer.ChannelTransmitManager",e),e.$inject=["PhysicalLayer.AbstractChannelManager","Common.MathUtil","Audio.ActiveAudioContext","PhysicalLayer.DefaultConfig","PhysicalLayer.ChannelTransmitBuilder"]}(),function(){function e(e){function t(t,i){return new e(t,i)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayer.RxHandlerBuilder",e),e.$inject=["PhysicalLayer.RxHandler"]}(),function(){function e(e,t,i){var r;return r=function(e,t){this.$$delayedData=[],this.$$rxConstellationDiagram=e,this.$$rxExternalHandler=t,this.$$intervalId=setInterval(this.$$intervalHandler.bind(this),r.$$_DELAY_LOOP_RESOLUTION)},r.$$_RX_EXTRA_DELAY=.05,r.$$_DELAY_LOOP_RESOLUTION=8,r.prototype.$$intervalHandler=function(){var e,i,n=t.getCurrentTime(),o=0;for(i=0;i<this.$$delayedData.length&&(e=this.$$delayedData[i],e.time<n-r.$$_RX_EXTRA_DELAY);i++)this.$$handle(e.channelIndex,e.carrierDetail,e.time),o++;o>0&&this.$$delayedData.splice(0,o)},r.prototype.handle=function(e,t,i){this.$$delayedData.push({channelIndex:e,carrierDetail:t,time:i})},r.prototype.$$handle=function(r,n,o){var a,s,$,l;for(a=0;a<n.length;a++)s=n[a],s.powerDecibel===-(1/0)&&(s.powerDecibel=e.MINIMUM_POWER_DECIBEL),s.powerDecibel=s.powerDecibel<e.MINIMUM_POWER_DECIBEL?e.MINIMUM_POWER_DECIBEL:s.powerDecibel,0!==this.$$rxConstellationDiagram.length&&($=this.$$rxConstellationDiagram[r].queue[a],l=(s.powerDecibel+e.CONSTELLATION_DIAGRAM_DECIBEL_LIMIT)/e.CONSTELLATION_DIAGRAM_DECIBEL_LIMIT,l=0>l?0:l,$.pushEvenIfFull(l*i.cos(i.TWO_PI*s.phase)),$.pushEvenIfFull(l*i.sin(i.TWO_PI*s.phase)));this.$$rxExternalHandler.callback&&this.$$rxExternalHandler.callback(r,n,t.getCurrentTime())},r.prototype.destroy=function(){clearInterval(this.$$intervalId)},r}AudioNetwork.Injector.registerFactory("PhysicalLayer.RxHandler",e),e.$inject=["PhysicalLayer.DefaultConfig","Audio.ActiveAudioContext","Common.MathUtil"]}(),function(){function e(e){function t(){return new e}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayerAdapter.GuardPowerCollectorBuilder",e),e.$inject=["PhysicalLayerAdapter.GuardPowerCollector"]}(),function(){function e(e,t){var i;return i=function(){e.apply(this,arguments)},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.EMPTY_LIST_EXCEPTION="Cannot finalize GuardPowerCollector without any samples collected",i.prototype.$$finalize=function(){if(0===this.$$valueList.length)throw i.EMPTY_LIST_EXCEPTION;return t.minInArray(this.$$valueList)},i}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.GuardPowerCollector",e),e.$inject=["Common.AbstractValueCollector","Common.MathUtil"]}(),function(){function e(e){function t(){return new e}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayerAdapter.PhaseOffsetCollectorBuilder",e),e.$inject=["PhysicalLayerAdapter.PhaseOffsetCollector"]}(),function(){function e(e,t){var i;return i=function(){e.apply(this,arguments)},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.$$finalize=function(){var e,i,r,n,o="";if(0===this.$$valueList.length)return null;for(e=0;e<this.$$valueList.length;e++)o+=t.round(1e3*this.$$valueList[e].time)/1e3+" "+t.round(1e3*this.$$valueList[e].phase)/1e3+" | ";return i=t.round(.43*this.$$valueList.length),r=t.round(.57*this.$$valueList.length),r=r>=this.$$valueList.length?this.$$valueList.length-1:r,n=0,i!==r&&r>i&&(console.log("phase history indexA",this.$$valueList[i].time,this.$$valueList[i].phase),console.log("phase history indexB",this.$$valueList[r].time,this.$$valueList[r].phase),n=-(this.$$valueList[r].phase-this.$$valueList[i].phase)/(this.$$valueList[r].time-this.$$valueList[i].time),console.log("phase history drift",n)),n},i.prototype.collect=function(e){this.$$valueList.push({time:e.stateDurationTime,phase:e.carrierDetail[0].phase})},i}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.PhaseOffsetCollector",e),e.$inject=["Common.AbstractValueCollector","Common.MathUtil"]}(),function(){function e(e){function t(t,i,r,n,o,a,s,$,l){return new e(t,i,r,n,o,a,s,$,l)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayerAdapter.RxStateMachineBuilder",e),e.$inject=["PhysicalLayerAdapter.RxStateMachine"]}(),function(){function e(e){var t;return t=function(t,i,r,n,o,a,s,$,l){this.$$stateHandler={},this.$$stateHandler[e.IDLE_INIT]=t,this.$$stateHandler[e.FIRST_SYNC_WAIT]=i,this.$$stateHandler[e.FIRST_SYNC]=r,this.$$stateHandler[e.FATAL_ERROR]=n,this.$$stateHandler[e.IDLE]=o,this.$$stateHandler[e.SYMBOL]=a,this.$$stateHandler[e.SYNC]=s,this.$$stateHandler[e.GUARD]=$,this.$$stateHandler[e.ERROR]=l,this.$$symbolStateMaxDurationTime=null,this.$$guardStateMaxDurationTime=null,this.$$syncStateMaxDurationTime=null,this.$$state=null,this.$$stateDurationTime=null,this.$$stateBeginTime=null,this.$$resetFlag=!0},t.SET_ALL_MAX_DURATION_TIMES_FIRST_EXCEPTION="Please set all max duration times first",t.prototype.scheduleReset=function(){this.$$resetFlag=!0},t.prototype.$$changeState=function(e,t){null!==e?(this.$$state=e,this.$$stateBeginTime=t):this.$$stateDurationTime=t-this.$$stateBeginTime},t.prototype.$$handlerIdleInit=function(t,i){var r;return this.$$changeState(null,i),r=this.$$stateHandler[e.IDLE_INIT](this.$$stateDurationTime),r?(this.$$changeState(r,i),!1):!0},t.prototype.$$handlerFirstSyncWait=function(t,i){return t?(this.$$changeState(e.FIRST_SYNC,i),!1):(this.$$changeState(null,i),this.$$stateHandler[e.FIRST_SYNC_WAIT](this.$$stateDurationTime),!0)},t.prototype.$$handlerFirstSync=function(t,i){var r;return this.$$changeState(null,i),r=this.$$stateHandler[e.FIRST_SYNC](this.$$stateDurationTime),r?(this.$$changeState(r,i),!1):!0},t.prototype.$$handlerFatalError=function(t,i){var r;return this.$$changeState(null,i),r=this.$$stateHandler[e.FATAL_ERROR](this.$$stateDurationTime),r?(this.$$changeState(r,i),!1):!0},t.prototype.$$handlerIdle=function(t,i){return t?(this.$$changeState(e.SYMBOL,i),!1):(this.$$changeState(null,i),this.$$stateHandler[e.IDLE](this.$$stateDurationTime),!0)},t.prototype.$$handlerSymbol=function(t,i){return t?(this.$$changeState(null,i),this.$$stateHandler[e.SYMBOL](this.$$stateDurationTime),this.$$stateDurationTime>this.$$symbolStateMaxDurationTime?(this.$$changeState(e.SYNC,i),!1):!0):(this.$$changeState(e.GUARD,i),!1)},t.prototype.$$handlerSync=function(t,i){return t?(this.$$changeState(null,i),this.$$stateHandler[e.SYNC](this.$$stateDurationTime),this.$$stateDurationTime>this.$$syncStateMaxDurationTime?(this.$$changeState(e.ERROR,i),!1):!0):(this.$$changeState(e.IDLE,i),!1)},t.prototype.$$handlerGuard=function(t,i){return t?(this.$$changeState(e.SYMBOL,i),!1):(this.$$changeState(null,i),this.$$stateHandler[e.GUARD](this.$$stateDurationTime),this.$$stateDurationTime>this.$$guardStateMaxDurationTime?(this.$$changeState(e.IDLE,i),!1):!0)},t.prototype.$$handlerError=function(t,i){return t?(this.$$changeState(null,i),this.$$stateHandler[e.ERROR](this.$$stateDurationTime),!0):(this.$$changeState(e.IDLE,i),!1)},t.prototype.setGuardStateMaxDurationTime=function(e){this.$$guardStateMaxDurationTime=e},t.prototype.setSymbolStateMaxDurationTime=function(e){this.$$symbolStateMaxDurationTime=e},t.prototype.setSyncStateMaxDurationTime=function(e){this.$$syncStateMaxDurationTime=e},t.prototype.getState=function(i,r){var n,o=e;if(this.$$resetFlag&&(this.$$changeState(o.IDLE_INIT,r),this.$$resetFlag=!1),null===this.$$guardStateMaxDurationTime||null===this.$$symbolStateMaxDurationTime||null===this.$$syncStateMaxDurationTime)throw t.SET_ALL_MAX_DURATION_TIMES_FIRST_EXCEPTION;for(;;){switch(this.$$state){case o.IDLE_INIT:n=this.$$handlerIdleInit(i,r);break;case o.FIRST_SYNC_WAIT:n=this.$$handlerFirstSyncWait(i,r);break;case o.FIRST_SYNC:n=this.$$handlerFirstSync(i,r);break;case o.FATAL_ERROR:n=this.$$handlerFatalError(i,r);break;case o.IDLE:n=this.$$handlerIdle(i,r);break;case o.SYMBOL:n=this.$$handlerSymbol(i,r);break;case o.SYNC:n=this.$$handlerSync(i,r);break;case o.GUARD:n=this.$$handlerGuard(i,r);break;case o.ERROR:n=this.$$handlerError(i,r)}if(n)break}return this.$$state},t}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.RxStateMachine",e),e.$inject=["PhysicalLayerAdapter.ReceiveAdapterState"]}(),function(){function e(e){function t(t,i,r,n){return new e(t,i,r,n)}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayerAdapter.RxStateMachineManagerBuilder",e),e.$inject=["PhysicalLayerAdapter.RxStateMachineManager"]}(),function(){function e(e,t,i,r,n,o,a,s,$){var l;return l=function(e,t,r,$){this.$$channelIndex=e,this.$$packetReceiveHandler=t,this.$$frequencyUpdateHandler=r,this.$$phaseCorrectionUpdateHandler=$,this.$$stateMachine=s.build(this.$$handlerIdleInit.bind(this),this.$$handlerFirstSyncWait.bind(this),this.$$handlerFirstSync.bind(this),this.$$handlerFatalError.bind(this),this.$$handlerIdle.bind(this),this.$$handlerSymbol.bind(this),this.$$handlerSync.bind(this),this.$$handlerGuard.bind(this),this.$$handlerError.bind(this)),this.$$sampleCollectionTimeIdleInitState=null,this.$$sampleCollectionTimeFirstSyncState=null,this.$$syncPreamble=null,this.$$pskSize=null,this.$$averageIdlePowerCollector=i.build(),this.$$averageFirstSyncPowerCollector=i.build(),this.$$signalPowerCollector=n.build(),this.$$guardPowerCollector=o.build(),this.$$phaseOffsetCollector=a.build(),this.$$resetInternal()},l.$$_INITIAL_POWER_THRESHOLD=0,l.$$_DECIBLES_ABOVE_AVERAGE_IDLE=10,l.$$_OFDM_PILOT_SIGNAL_INDEX=0,l.$$_AVERAGE_POWER_UNIT_FACTOR=.5,l.prototype.$$resetInternal=function(){this.$$averageIdlePowerCollector.clearAll(),this.$$averageFirstSyncPowerCollector.clearAll(),this.$$signalPowerCollector.clearAll(),this.$$guardPowerCollector.clearAll(),this.$$phaseOffsetCollector.clearAll(),this.$$powerThreshold=l.$$_INITIAL_POWER_THRESHOLD,this.$$currentData=null,this.$$dataPacket=[],this.$$dataSymbol=[]},l.prototype.reset=function(){this.$$resetInternal(),this.$$stateMachine.scheduleReset()},l.prototype.setSymbolStateMaxDurationTime=function(e){this.$$stateMachine.setSymbolStateMaxDurationTime(e)},l.prototype.setGuardStateMaxDurationTime=function(e){this.$$stateMachine.setGuardStateMaxDurationTime(e)},l.prototype.setSyncStateMaxDurationTime=function(e){this.$$stateMachine.setSyncStateMaxDurationTime(e)},l.prototype.setSampleCollectionTimeIdleInitState=function(e){this.$$sampleCollectionTimeIdleInitState=e},l.prototype.setSampleCollectionTimeFirstSyncState=function(e){this.$$sampleCollectionTimeFirstSyncState=e},l.prototype.setSyncPreamble=function(e){this.$$syncPreamble=e},l.prototype.setPskSize=function(e){this.$$pskSize=e},l.prototype.$$handlerIdleInit=function(e){var t=this.$$currentData.pilotSignal.powerDecibel,i=null;if(e<this.$$sampleCollectionTimeIdleInitState)this.$$averageIdlePowerCollector.collect(t);else try{this.$$powerThreshold=this.$$averageIdlePowerCollector.finalize()+l.$$_DECIBLES_ABOVE_AVERAGE_IDLE,i=$.FIRST_SYNC_WAIT}catch(r){i=$.FATAL_ERROR}return i},l.prototype.$$handlerFirstSyncWait=function(e){return null},l.prototype.$$handlerFirstSync=function(e){var t,i,r,n=this.$$currentData.pilotSignal.powerDecibel;if(this.$$averageFirstSyncPowerCollector.getLastFinalizedResult())return n<this.$$powerThreshold?$.IDLE:null;if(n<=this.$$averageIdlePowerCollector.getLastFinalizedResult())return $.FATAL_ERROR;if(e<this.$$sampleCollectionTimeFirstSyncState)this.$$phaseOffsetCollector.collect({stateDurationTime:e,carrierDetail:this.$$currentData.carrierDetail}),this.$$averageFirstSyncPowerCollector.collect(n);else try{t=this.$$averageFirstSyncPowerCollector.finalize(),i=this.$$averageIdlePowerCollector.getLastFinalizedResult(),r=t-i,this.$$powerThreshold=i+l.$$_AVERAGE_POWER_UNIT_FACTOR*r}catch(o){return $.FATAL_ERROR}},l.prototype.$$handlerFatalError=function(e){},l.prototype.$$handlerIdle=function(e){this.$$dataPacket.length>0&&(this.$$packetReceiveHandler(this.$$channelIndex,this.$$preparePacket(this.$$dataPacket)),this.$$dataPacket.length=0),this.$$phaseOffsetCollector.hasAtLeastItem()&&this.$$frequencyUpdateHandler(this.$$channelIndex,this.$$phaseOffsetCollector.finalize()),this.$$guardPowerCollector.clearList()},l.prototype.$$handlerSymbol=function(e){var t=this.$$currentData.pilotSignal.powerDecibel;this.$$signalPowerCollector.collect(t),this.$$guardPowerCollector.hasAtLeastItem()&&this.$$guardPowerCollector.finalize(),this.$$dataSymbol.push(this.$$currentData)},l.prototype.$$handlerSync=function(e){this.$$phaseOffsetCollector.collect({stateDurationTime:e,carrierDetail:this.$$currentData.carrierDetail})},l.prototype.$$handlerGuard=function(e){var i,r=this.$$currentData.pilotSignal.powerDecibel;this.$$guardPowerCollector.collect(r),this.$$signalPowerCollector.hasAtLeastItem()&&this.$$signalPowerCollector.finalize(),this.$$dataSymbol.length>0&&(i=t.findMaxValueIndex(this.$$dataSymbol,"pilotSignal.powerDecibel"),this.$$dataPacket.push(this.$$dataSymbol[i].carrierDetail),this.$$isCurrentSymbolSyncPreamble()&&this.$$phaseCorrectionUpdateHandler(this.$$channelIndex,this.$$dataSymbol[i].carrierDetail),this.$$dataSymbol=[])},l.prototype.$$handlerError=function(e){},l.prototype.$$preparePacket=function(t){var i,r,n,o,a;for(n=[],i=0;i<t.length;i++)if(0!==i||!this.$$syncPreamble){for(a=t[i],o=[],r=0;r<a.length;r++)o.push(e.round(a[r].phase*this.$$pskSize)%this.$$pskSize);n.push(o)}return n},l.prototype.$$isCurrentSymbolSyncPreamble=function(){return this.$$syncPreamble&&1===this.$$dataPacket.length},l.prototype.$$isInputReallyConnected=function(){return this.$$currentData.pilotSignal.powerDecibel!==r.MINIMUM_POWER_DECIBEL},l.prototype.$$isPilotSignalPresent=function(){return this.$$currentData.pilotSignal.powerDecibel>this.$$powerThreshold},l.prototype.receive=function(t,i){var r;return this.$$currentData={pilotSignal:t[l.$$_OFDM_PILOT_SIGNAL_INDEX],carrierDetail:t},this.$$isInputReallyConnected()?r=this.$$stateMachine.getState(this.$$isPilotSignalPresent(),i):(r=$.NO_INPUT,this.reset()),{state:r,power:"<br/>averageIdlePower: "+e.round(100*this.$$averageIdlePowerCollector.getLastFinalizedResult())/100+"<br/>averageFirstSyncPower: "+e.round(100*this.$$averageFirstSyncPowerCollector.getLastFinalizedResult())/100+" <br/>&nbsp;&nbsp;&nbsp;delta: "+e.round(100*(this.$$averageFirstSyncPowerCollector.getLastFinalizedResult()-this.$$averageIdlePowerCollector.getLastFinalizedResult()))/100+" <br/>&nbsp;&nbsp;&nbsp;powerThreshold: "+e.round(100*this.$$powerThreshold)/100+" <br/>minGuardPower: "+e.round(100*this.$$guardPowerCollector.getLastFinalizedResult())/100+" sampleSize: "+this.$$guardPowerCollector.getLastFinalizedSize()+"<br/>maxSignalPower: "+e.round(100*this.$$signalPowerCollector.getLastFinalizedResult())/100+" sampleSize: "+this.$$signalPowerCollector.getLastFinalizedSize()+"<br/>&nbsp;&nbsp;&nbsp;delta: "+e.round(100*(this.$$signalPowerCollector.getLastFinalizedResult()-this.$$guardPowerCollector.getLastFinalizedResult()))/100+" <br/>&nbsp;&nbsp;&nbsp;idealPowerThreshold: "+e.round(.5*(this.$$signalPowerCollector.getLastFinalizedResult()+this.$$guardPowerCollector.getLastFinalizedResult())*100)/100+" <br/>"}},l}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.RxStateMachineManager",e),e.$inject=["Common.MathUtil","Common.Util","Common.AverageValueCollectorBuilder","PhysicalLayer.DefaultConfig","PhysicalLayerAdapter.SignalPowerCollectorBuilder","PhysicalLayerAdapter.GuardPowerCollectorBuilder","PhysicalLayerAdapter.PhaseOffsetCollectorBuilder","PhysicalLayerAdapter.RxStateMachineBuilder","PhysicalLayerAdapter.ReceiveAdapterState"]}(),function(){function e(e){function t(){return new e}return{build:t}}AudioNetwork.Injector.registerService("PhysicalLayerAdapter.SignalPowerCollectorBuilder",e),e.$inject=["PhysicalLayerAdapter.SignalPowerCollector"]}(),function(){function e(e,t){var i;return i=function(){e.apply(this,arguments)},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.EMPTY_LIST_EXCEPTION="Cannot finalize SignalPowerCollector without any samples collected",i.prototype.$$finalize=function(){if(0===this.$$valueList.length)throw i.EMPTY_LIST_EXCEPTION;return t.maxInArray(this.$$valueList)},i}AudioNetwork.Injector.registerFactory("PhysicalLayerAdapter.SignalPowerCollector",e),e.$inject=["Common.AbstractValueCollector","Common.MathUtil"]}(),function(){function e(e){var t;return t=function(e,t,i){this.$$parentElement=e,this.$$width=t,this.$$height=i,this.$$canvasContext=null,this.$$destroyPromise=null,this.$$parentElement.innerHTML=this.$$renderTemplate(),this.$$initCanvas(),requestAnimationFrame(this.$$animationFrameHandler.bind(this))},t.ABSTRACT_METHOD_CALLED_EXCEPTION="Abstract method called!",t.prototype.destroy=function(){return this.$$destroyPromise?this.$$destroyPromise:(this.$$destroyPromise=e.build(),this.$$destroyPromise)},t.prototype.$$find=function(e){var t=this.$$parentElement.querySelectorAll(e);if(0===t.length)throw"Cannot $$find given selector";return t[0]},t.prototype.$$initCanvas=function(){var e=this.$$find("canvas");this.$$canvasContext=e.getContext("2d")},t.prototype.$$animationFrameHandler=function(){this.$$destroyPromise?(this.$$parentElement.innerHTML="",this.$$destroyPromise.resolve()):(this.$$canvasContext&&this.$$draw(),requestAnimationFrame(this.$$animationFrameHandler.bind(this)))},t.prototype.$$draw=function(){throw t.ABSTRACT_METHOD_CALLED_EXCEPTION},t.prototype.$$renderTemplate=function(){throw t.ABSTRACT_METHOD_CALLED_EXCEPTION},t}AudioNetwork.Injector.registerFactory("Visualizer.AbstractVisualizer",e),e.$inject=["Common.SimplePromiseBuilder"]}(),function(){function e(e){function t(t,i,r,n,o){return new e(t,i,r,n,o)}return{build:t}}AudioNetwork.Injector.registerService("Visualizer.AnalyserChartBuilder",e),e.$inject=["Visualizer.AnalyserChart"]}(),function(){function e(){var e='<span    style="        display: block;        box-sizing: border-box;        border-left: 1px solid {{ colorAxis }};        position: absolute;        width: {{ width }}px;        top: 0px;        left: {{ left }}px;        "    >    {{ label }}</span>';return{html:e}}AudioNetwork.Injector.registerService("Visualizer.AnalyserChartTemplateAxisX",e),e.$inject=[]}(),function(){function e(){var e='<div    class="analyser-container"    style="        overflow: hidden;        width: {{ width }}px;        height: {{ height }}px;        position: relative;    "    >    <canvas        class="analyser-chart"        style="            width: {{ width }}px;            height: {{ height }}px;            position: absolute;        "        width="{{ width }}"        height="{{ height }}"        ></canvas>    <div        class="analyser-action"        style="            position: absolute;        "        >        <a href="javascript:void(0)" class="analyser-action-fft256">FFT256</a>        <a href="javascript:void(0)" class="analyser-action-fft512">FFT512</a>        <a href="javascript:void(0)" class="analyser-action-fft1024">FFT1024</a>        <a href="javascript:void(0)" class="analyser-action-fft2048">FFT2048</a>        <a href="javascript:void(0)" class="analyser-action-fft4096">FFT4096</a>        <a href="javascript:void(0)" class="analyser-action-fft8192">FFT8192</a>        <a href="javascript:void(0)" class="analyser-action-fft16384">FFT16384</a>        <a href="javascript:void(0)" class="analyser-action-freq-timedomain">Freq/TimeDomain</a>        <a href="javascript:void(0)" class="analyser-action-freeze">Freeze</a>    </div>    <div         class="analyser-axis-x"         style="            position: absolute;            bottom: 0px;            left: 0px;            width: {{ width }}px;        "        ></div></div>';return{html:e}}AudioNetwork.Injector.registerService("Visualizer.AnalyserChartTemplateMain",e),
e.$inject=[]}(),function(){function e(e,t,i,r,n){var o;return o=function(e,t,i,r,n){this.$$parentElement=e,this.$$analyser=t,this.$$canvas=null,this.$$canvasContext=null,this.$$canvasWidth=null,this.$$canvasHeight=i,this.$$colorData=r,this.$$colorAxis=n,this.$$data=null,this.$$freezeChart=!1,this.$$analyserMethod="getByteFrequencyData",this.$$destroyPromise=null,this.$$initAnimationFrame(),this.$$init()},o.$$_AXIS_LABEL_X_ONE_ITEM_WITH=40,o.prototype.destroy=function(){return this.$$destroyPromise?this.$$destroyPromise:(this.$$destroyPromise=i.build(),this.$$destroyPromise)},o.prototype.$$init=function(){this.$$canvasContext=null,this.$$parentElement.innerHTML=this.$$renderTemplate(),this.$$connectTemplate(),this.$$initCanvasContext()},o.prototype.$$find=function(e){var t=this.$$parentElement.querySelectorAll(e);if(0===t.length)throw"Cannot $$find given selector";return t[0]},o.prototype.$$connectTemplate=function(){var e=this;this.$$canvas=this.$$find(".analyser-chart"),this.$$canvasContext=this.$$canvas.getContext("2d"),this.$$canvasWidth=this.$$analyser.fftSize,this.$$find(".analyser-action-freq-timedomain").addEventListener("click",function(){e.actionFrequencyTimeDomainToggle()}),this.$$find(".analyser-action-freeze").addEventListener("click",function(){e.actionFreezeChart()}),this.$$find(".analyser-action-fft256").addEventListener("click",function(){e.actionChangeFFTSize(256)}),this.$$find(".analyser-action-fft512").addEventListener("click",function(){e.actionChangeFFTSize(512)}),this.$$find(".analyser-action-fft1024").addEventListener("click",function(){e.actionChangeFFTSize(1024)}),this.$$find(".analyser-action-fft2048").addEventListener("click",function(){e.actionChangeFFTSize(2048)}),this.$$find(".analyser-action-fft4096").addEventListener("click",function(){e.actionChangeFFTSize(4096)}),this.$$find(".analyser-action-fft8192").addEventListener("click",function(){e.actionChangeFFTSize(8192)}),this.$$find(".analyser-action-fft16384").addEventListener("click",function(){e.actionChangeFFTSize(16384)})},o.prototype.actionFrequencyTimeDomainToggle=function(){"getByteFrequencyData"===this.$$analyserMethod?this.$$analyserMethod="getByteTimeDomainData":this.$$analyserMethod="getByteFrequencyData",this.$$generateAxisX()},o.prototype.actionFreezeChart=function(){this.$$freezeChart=!this.$$freezeChart},o.prototype.actionChangeFFTSize=function(e){this.$$analyser.fftSize=e,this.$$init()},o.prototype.$$renderTemplate=function(){var e=t.html;return e=e.replace(/\{\{ width \}\}/g,this.$$analyser.frequencyBinCount.toString()),e=e.replace(/\{\{ height \}\}/g,this.$$canvasHeight.toString())},o.prototype.$$renderTemplateAxisXLabel=function(t,i,r){var n=e.html;return n=n.replace(/\{\{ width \}\}/g,t),n=n.replace(/\{\{ left \}\}/g,i),n=n.replace(/\{\{ label \}\}/g,r),n=n.replace(/\{\{ colorAxis \}\}/g,this.$$colorAxis)},o.prototype.$$generateAxisXForTimeDomain=function(){var e,t,i=[5e-4,.001,.002,.005,.01,.025,.05,.1,.25,.5],a=r.getSampleRate(),s=o.$$_AXIS_LABEL_X_ONE_ITEM_WITH/a,$=0,l="";for(t=0;t<i.length;t++)if(i[t]>=s||t==i.length-1){s=i[t];break}for(;$<this.$$analyser.frequencyBinCount/r.getSampleRate();)e=n.round($*a),l+=this.$$renderTemplateAxisXLabel(o.$$_AXIS_LABEL_X_ONE_ITEM_WITH,e,n.round(1e3*$)+"ms"),$+=s;return l},o.prototype.$$generateAxisXForFrequency=function(){var e,t,i=[50,100,125,200,250,500,1e3,2e3,2500,5e3,1e4,2e4],a=this.$$analyser.fftSize/r.getSampleRate(),s=o.$$_AXIS_LABEL_X_ONE_ITEM_WITH/a,$=0,l="";for(t=0;t<i.length;t++)if(i[t]>=s||t==i.length-1){s=i[t];break}for(;$<.5*r.getSampleRate();)e=n.round($*a),l+=this.$$renderTemplateAxisXLabel(o.$$_AXIS_LABEL_X_ONE_ITEM_WITH,e,$+"Hz"),$+=s;return l},o.prototype.$$generateAxisX=function(){var e=this.$$find(".analyser-axis-x");"getByteFrequencyData"==this.$$analyserMethod?e.innerHTML="<span>&nbsp;</span>"+this.$$generateAxisXForFrequency():e.innerHTML="<span>&nbsp;</span>"+this.$$generateAxisXForTimeDomain()},o.prototype.$$updateChart=function(){var e,t=this.$$data.length,i=this.$$canvasContext;if(null!==i&&!this.$$freezeChart)for(i.clearRect(0,0,this.$$canvasWidth,this.$$canvasHeight),this.$$analyser[this.$$analyserMethod](this.$$data),e=0;t>e;e++)i.beginPath(),i.moveTo(e,this.$$canvasHeight),i.lineTo(e,this.$$canvasHeight-n.round(this.$$canvasHeight*this.$$data[e]/255)),i.closePath(),i.stroke()},o.prototype.$$initCanvasContext=function(){this.$$data=new Uint8Array(this.$$analyser.frequencyBinCount),this.$$generateAxisX(),this.$$canvasContext.lineWidth=1,this.$$canvasContext.strokeStyle=this.$$colorData},o.prototype.$$initAnimationFrame=function(){function e(){t.$$destroyPromise?(t.$$parentElement.innerHTML="",t.$$destroyPromise.resolve()):(t.$$updateChart(),requestAnimationFrame(e))}var t=this;requestAnimationFrame(e)},o}AudioNetwork.Injector.registerFactory("Visualizer.AnalyserChart",e),e.$inject=["Visualizer.AnalyserChartTemplateAxisX","Visualizer.AnalyserChartTemplateMain","Common.SimplePromiseBuilder","Audio.ActiveAudioContext","Common.MathUtil"]}(),function(){function e(e){function t(t,i,r,n,o,a){return new e(t,i,r,n,o,a)}return{build:t}}AudioNetwork.Injector.registerService("Visualizer.ConstellationDiagramBuilder",e),e.$inject=["Visualizer.ConstellationDiagram"]}(),function(){function e(){var e='<div    class="constellation-diagram-container"    style="        overflow: hidden;        width: {{ width }}px;        height: {{ height }}px;        position: relative;    "    >    <canvas         class="constellation-diagram"        style="            width: {{ width }}px;            height: {{ height }}px;            position: absolute;        "        width="{{ width }}"        height="{{ height }}"        ></canvas></div>';return{html:e}}AudioNetwork.Injector.registerService("Visualizer.ConstellationDiagramTemplateMain",e),e.$inject=[]}(),function(){function e(e,t,i){var r;return r=function(e,t,i,r,n,o){this.$$parentElement=e,this.$$queue=t,this.$$canvas=null,this.$$canvasContext=null,this.$$canvasWidth=i,this.$$canvasHeight=r,this.$$colorAxis=n,this.$$colorHistoryPoint=o,this.$$destroyPromise=null,this.$$initAnimationFrame(),this.$$init()},r.prototype.destroy=function(){return this.$$destroyPromise?this.$$destroyPromise:(this.$$destroyPromise=t.build(),this.$$destroyPromise)},r.prototype.$$init=function(){this.$$canvasContext=null,this.$$parentElement.innerHTML=this.$$renderTemplate(),this.$$connectTemplate(),this.$$initCanvasContext()},r.prototype.$$find=function(e){var t=this.$$parentElement.querySelectorAll(e);if(0===t.length)throw"Cannot $$find given selector";return t[0]},r.prototype.$$connectTemplate=function(){this.$$canvas=this.$$find(".constellation-diagram"),this.$$canvasContext=this.$$canvas.getContext("2d")},r.prototype.$$renderTemplate=function(){var e=i.html;return e=e.replace(/\{\{ width \}\}/g,this.$$canvasWidth.toString()),e=e.replace(/\{\{ height \}\}/g,this.$$canvasHeight.toString())},r.prototype.$$updateChart=function(){var e,t,i,r,n,o,a,s=this.$$colorHistoryPoint,$=this.$$canvasContext,l=this.$$canvasWidth,c=this.$$canvasHeight,h=.5*this.$$canvasWidth,u=.5*this.$$canvasHeight,p=this.$$queue;if(null!==$)for($.clearRect(0,0,l,c),$.beginPath(),$.moveTo(0,u),$.lineTo(l,u),$.closePath(),$.stroke(),$.beginPath(),$.moveTo(h,0),$.lineTo(h,c),$.closePath(),$.stroke(),e=.5*p.getSize(),o=0;e>o;o++)r=h+h*p.getItem(2*o),n=u-u*p.getItem(2*o+1),t=1-o/(e-2),a=o===e-1,i=a?"rgba("+s.red.newest+", "+s.green.newest+", "+s.blue.newest+", 1)":"rgba("+this.$$colorInterpolate(s.red.tailNewest,s.red.tailOldest,t)+", "+this.$$colorInterpolate(s.green.tailNewest,s.green.tailOldest,t)+", "+this.$$colorInterpolate(s.blue.tailNewest,s.blue.tailOldest,t)+", 1)",$.fillStyle=i,$.fillRect(r-(a?2:1),n-(a?2:1),a?5:3,a?5:3)},r.prototype.$$colorInterpolate=function(t,i,r){return e.round(t+(i-t)*r)},r.prototype.$$initCanvasContext=function(){this.$$canvasContext.lineWidth=1,this.$$canvasContext.strokeStyle=this.$$colorAxis},r.prototype.$$initAnimationFrame=function(){function e(){t.$$destroyPromise?(t.$$parentElement.innerHTML="",t.$$destroyPromise.resolve()):(t.$$updateChart(),requestAnimationFrame(e))}var t=this;requestAnimationFrame(e)},r}AudioNetwork.Injector.registerFactory("Visualizer.ConstellationDiagram",e),e.$inject=["Common.MathUtil","Common.SimplePromiseBuilder","Visualizer.ConstellationDiagramTemplateMain"]}(),function(){function e(e){function t(t,i,r){return new e(t,i,r)}return{build:t}}AudioNetwork.Injector.registerService("Visualizer.PowerChartBuilder",e),e.$inject=["Visualizer.PowerChart"]}(),function(){function e(){var e='<div    class="power-chart-container"    style="        overflow: hidden;        width: {{ width }}px;        height: {{ height }}px;        position: relative;    "    >    <canvas         class="power-chart"        style="            width: {{ width }}px;            height: {{ height }}px;            position: absolute;        "        width="{{ width }}"        height="{{ height }}"        ></canvas></div>';return{html:e}}AudioNetwork.Injector.registerService("Visualizer.PowerChartTemplateMain",e),e.$inject=[]}(),function(){function e(e,t){var i;return i=function(e,t,i,r){this.$$parentElement=e,this.$$canvas=null,this.$$canvasContext=null,this.$$canvasWidth=t,this.$$canvasHeight=i,this.$$queue=r,this.$$destroyPromise=null,this.$$initAnimationFrame(),this.$$init()},i.prototype.destroy=function(){return this.$$destroyPromise?this.$$destroyPromise:(this.$$destroyPromise=t.build(),this.$$destroyPromise)},i.prototype.$$init=function(){this.$$canvasContext=null,this.$$parentElement.innerHTML=this.$$renderTemplate(),this.$$connectTemplate(),this.$$initCanvasContext()},i.prototype.$$find=function(e){var t=this.$$parentElement.querySelectorAll(e);if(0===t.length)throw"Cannot $$find given selector";return t[0]},i.prototype.$$connectTemplate=function(){this.$$canvas=this.$$find(".power-chart"),this.$$canvasContext=this.$$canvas.getContext("2d")},i.prototype.$$renderTemplate=function(){var t=e.html;return t=t.replace(/\{\{ width \}\}/g,this.$$canvasWidth.toString()),t=t.replace(/\{\{ height \}\}/g,this.$$canvasHeight.toString())},i.prototype.$$updateChart=function(){var e,t,i,r,n=this.$$canvasContext,o=this.$$queue,a=this.$$canvasWidth,s=this.$$canvasHeight;if(null!==n){for(n.clearRect(0,0,a,s),r=0;s>r;r+=10)n.strokeStyle="#EEE",n.beginPath(),n.moveTo(0,2*r),n.lineTo(a,2*r),n.closePath(),n.stroke();for(t=0;t<o.getSize();t++)e=o.getItem(t),i=t,r=-e,n.fillStyle="#738BD7",n.fillRect(i-1,2*r-1,3,3)}},i.prototype.$$initCanvasContext=function(){this.$$canvasContext.lineWidth=1},i.prototype.$$initAnimationFrame=function(){function e(){t.$$destroyPromise?(t.$$parentElement.innerHTML="",t.$$destroyPromise.resolve()):(t.$$updateChart(),requestAnimationFrame(e))}var t=this;requestAnimationFrame(e)},i}AudioNetwork.Injector.registerFactory("Visualizer.PowerChart",e),e.$inject=["Visualizer.PowerChartTemplateMain","Common.SimplePromiseBuilder"]}(),function(){function e(e){function t(t,i,r){return new e(t,i,r)}return{build:t}}AudioNetwork.Injector.registerService("Visualizer.SampleChartBuilder",e),e.$inject=["Visualizer.SampleChart"]}(),function(){function e(){var e='<div    class="power-chart-container"    style="        overflow: hidden;        width: {{ width }}px;        height: {{ height }}px;        position: relative;    "    >    <canvas         class="power-chart"        style="            width: {{ width }}px;            height: {{ height }}px;            position: absolute;        "        width="{{ width }}"        height="{{ height }}"        ></canvas></div>';return{html:e}}AudioNetwork.Injector.registerService("Visualizer.SampleChartTemplateMain",e),e.$inject=[]}(),function(){function e(e,t,i){var r;return r=function(t,n,o,a,s,$){if(e.call(this,t,n,o),a.getSizeMax()!==n)throw r.QUEUE_SIZE_NOT_MATCH_CHART_WIDTH;this.$$queue=a,this.$$colorAxis=i.valueOrDefault(s,"#EEE"),this.$$colorSample=i.valueOrDefault($,"#738BD7")},r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.QUEUE_SIZE_NOT_MATCH_CHART_WIDTH="Queue size not match chart width",r.prototype.$$renderTemplate=function(){var e=t.html;return e=e.replace(/\{\{ width \}\}/g,this.$$width.toString()),e=e.replace(/\{\{ height \}\}/g,this.$$height.toString())},r.prototype.$$draw=function(){var e,t,i,r,n=this.$$canvasContext,o=this.$$queue,a=this.$$width,s=this.$$height;for(n.clearRect(0,0,a,s),n.strokeStyle=this.$$colorAxis,n.beginPath(),n.moveTo(0,.5*s),n.lineTo(a,.5*s),n.closePath(),n.stroke(),t=0;t<o.getSize();t++)e=o.getItem(t),i=t,r=(.5-.5*e)*s,n.fillStyle=this.$$colorSample,n.fillRect(i-1,r-1,3,3)},r.prototype.$$initCanvasContext=function(){this.$$canvasContext.lineWidth=1},r}AudioNetwork.Injector.registerFactory("Visualizer.SampleChart",e),e.$inject=["Visualizer.AbstractVisualizer","Visualizer.SampleChartTemplateMain","Common.Util"]}(),AudioNetwork.PhysicalLayer={},AudioNetwork.PhysicalLayer.PhysicalLayer=AudioNetwork.Injector.resolve("PhysicalLayer.PhysicalLayer"),AudioNetwork.PhysicalLayer.DefaultConfig=AudioNetwork.Injector.resolve("PhysicalLayer.DefaultConfig"),AudioNetwork.PhysicalLayer.RxInput=AudioNetwork.Injector.resolve("PhysicalLayer.RxInput"),AudioNetwork.PhysicalLayerAdapter={},AudioNetwork.PhysicalLayerAdapter.TransmitAdapter=AudioNetwork.Injector.resolve("PhysicalLayerAdapter.TransmitAdapter"),AudioNetwork.PhysicalLayerAdapter.ReceiveAdapter=AudioNetwork.Injector.resolve("PhysicalLayerAdapter.ReceiveAdapter"),AudioNetwork.Audio={},AudioNetwork.Audio.ActiveAudioContext=AudioNetwork.Injector.resolve("Audio.ActiveAudioContext"),AudioNetwork.Audio.SimpleAudioContext=AudioNetwork.Injector.resolve("Audio.SimpleAudioContext"),AudioNetwork.Common={},AudioNetwork.Common.Queue=AudioNetwork.Injector.resolve("Common.Queue"),AudioNetwork.Common.CarrierRecovery=AudioNetwork.Injector.resolve("Common.CarrierRecovery"),AudioNetwork.Common.CarrierGenerate=AudioNetwork.Injector.resolve("Common.CarrierGenerate"),AudioNetwork.Visualizer={},AudioNetwork.Visualizer.AnalyserChart=AudioNetwork.Injector.resolve("Visualizer.AnalyserChart"),AudioNetwork.Visualizer.ConstellationDiagram=AudioNetwork.Injector.resolve("Visualizer.ConstellationDiagram"),AudioNetwork.Visualizer.PowerChart=AudioNetwork.Injector.resolve("Visualizer.PowerChart"),AudioNetwork.Visualizer.SampleChart=AudioNetwork.Injector.resolve("Visualizer.SampleChart");